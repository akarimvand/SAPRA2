<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punch List Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #1abc9c;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--secondary-color), #34495e);
            color: white;
            padding: 25px 0;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: white;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 600;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            padding: 15px;
        }
        
        #dataGrid {
            height: 500px;
            width: 100%;
            border-radius: 0 0 10px 10px;
        }
        
        .summary-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .summary-icon {
            font-size: 40px;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        
        .total-issues {
            background: linear-gradient(135deg, var(--primary-color), #5dade2);
        }
        
        .remaining {
            background: linear-gradient(135deg, var(--danger-color), #ec7063);
        }
        
        .released {
            background: linear-gradient(135deg, var(--success-color), #58d68d);
        }
        
        .recent-activity {
            background: linear-gradient(135deg, var(--warning-color), #f5b041);
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            width: 3rem;
            height: 3rem;
        }
        
        .last-updated {
            font-size: 12px;
            color: #7f8c8d;
            text-align: right;
            margin-top: 10px;
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background: transparent;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-clipboard-list me-2"></i> Punch List Management Dashboard</h1>
                    <p class="mb-0">Comprehensive overview of punch list items by discipline and category</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light btn-sm me-2"><i class="fas fa-download me-1"></i> Export</button>
                    <button class="btn btn-light btn-sm"><i class="fas fa-cog me-1"></i> Settings</button>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row">
            <div class="col-md-3">
                <div class="summary-card total-issues">
                    <div class="summary-icon"><i class="fas fa-tasks"></i></div>
                    <div class="summary-value" id="totalIssues">-</div>
                    <div class="summary-label">Total Issues</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="summary-card remaining">
                    <div class="summary-icon"><i class="fas fa-exclamation-circle"></i></div>
                    <div class="summary-value" id="totalRemaining">-</div>
                    <div class="summary-label">Total Remaining</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="summary-card released">
                    <div class="summary-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="summary-value" id="totalReleased">-</div>
                    <div class="summary-label">Total Released</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="summary-card recent-activity">
                    <div class="summary-icon"><i class="fas fa-bolt"></i></div>
                    <div class="summary-value" id="recentIssued">-</div>
                    <div class="summary-label">Issued Last 30 Days</div>
                </div>
            </div>
        </div>

        <!-- Tabs for different views -->
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">Overview</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="discipline-tab" data-bs-toggle="tab" data-bs-target="#discipline" type="button" role="tab">By Discipline</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="category-tab" data-bs-toggle="tab" data-bs-target="#category" type="button" role="tab">By Category</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab">Trends</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="dashboardTabsContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-chart-pie me-2"></i>Status Distribution</span>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="showPercentages" checked>
                                    <label class="form-check-label" for="showPercentages">Show %</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="statusPieChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-chart-bar me-2"></i>Issues by Discipline & Category</span>
                                <select class="form-select form-select-sm" id="stackedBarMetric" style="width: 150px; display: inline-block;">
                                    <option value="Issue_Punch">Total Issues</option>
                                    <option value="Total_Remain">Remaining</option>
                                    <option value="Release_Punch">Released</option>
                                </select>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="disciplineCategoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="fas fa-table me-2"></i>Detailed Punch List Data</span>
                                <button class="btn btn-sm btn-outline-light" id="exportBtn"><i class="fas fa-download me-1"></i>Export</button>
                            </div>
                            <div class="card-body p-0">
                                <div id="dataGrid" class="ag-theme-alpine"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- By Discipline Tab -->
            <div class="tab-pane fade" id="discipline" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-line me-2"></i>Issues by Discipline
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="disciplineBarChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-percentage me-2"></i>Completion Rate by Discipline
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="completionRateChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- By Category Tab -->
            <div class="tab-pane fade" id="category" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-bar me-2"></i>Issues by Category
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="categoryBarChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-pie me-2"></i>Remaining Issues by Category
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="remainingPieChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trends Tab -->
            <div class="tab-pane fade" id="trends" role="tabpanel">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-line me-2"></i>Recent Activity Trends
                                <select class="form-select form-select-sm" id="trendTimeFrame" style="width: 150px; display: inline-block;">
                                    <option value="30">Last 30 Days</option>
                                    <option value="7">Last 7 Days</option>
                                    <option value="1">Today</option>
                                </select>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="activityTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Last Updated -->
        <div class="last-updated">
            <i class="fas fa-sync-alt me-1"></i> Last updated: <span id="lastUpdated">Loading...</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let gridData = [];
        let charts = {};
        
        // Load data from CSV
        function loadData() {
            const loadingSpinner = document.createElement('div');
            loadingSpinner.className = 'loading-spinner';
            loadingSpinner.innerHTML = '<div class="spinner-border text-primary spinner" role="status"><span class="visually-hidden">Loading...</span></div>';
            document.getElementById('dataGrid').replaceWith(loadingSpinner);
            
            Papa.parse('https://raw.githubusercontent.com/akarimvand/SAPRA2/refs/heads/main/PNC.CSV', {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    gridData = results.data.map(item => {
                        return {
                            discipline: item.PL_Discipline,
                            category: item.PL_Punch_Category,
                            issued: parseInt(item.Issue_Punch),
                            released: parseInt(item.Release_Punch),
                            remaining: parseInt(item.Total_Remain),
                            released30: parseInt(item.Released_Last_30_Days),
                            released7: parseInt(item.Released_Last_7_Days),
                            releasedToday: parseInt(item.Released_Today),
                            issued30: parseInt(item.Issued_Last_30_Days),
                            issued7: parseInt(item.Issued_Last_7_Days),
                            issuedToday: parseInt(item.Issued_Today),
                            completionRate: (parseInt(item.Release_Punch) / parseInt(item.Issue_Punch) * 100).toFixed(1)
                        };
                    });
                    
                    // Update summary cards
                    updateSummaryCards();
                    
                    // Initialize charts
                    initCharts();
                    
                    // Initialize grid
                    initGrid();
                    
                    // Update last updated time
                    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                },
                error: function(error) {
                    console.error('Error loading CSV:', error);
                    document.getElementById('dataGrid').innerHTML = '<div class="alert alert-danger">Error loading data. Please try again later.</div>';
                }
            });
        }
        
        // Update summary cards
        function updateSummaryCards() {
            const totalIssues = gridData.reduce((sum, item) => sum + item.issued, 0);
            const totalReleased = gridData.reduce((sum, item) => sum + item.released, 0);
            const totalRemaining = gridData.reduce((sum, item) => sum + item.remaining, 0);
            const recentIssued = gridData.reduce((sum, item) => sum + item.issued30, 0);
            
            document.getElementById('totalIssues').textContent = totalIssues.toLocaleString();
            document.getElementById('totalReleased').textContent = totalReleased.toLocaleString();
            document.getElementById('totalRemaining').textContent = totalRemaining.toLocaleString();
            document.getElementById('recentIssued').textContent = recentIssued.toLocaleString();
        }
        
        // Initialize charts
        function initCharts() {
            // Status Pie Chart
            const totalIssues = gridData.reduce((sum, item) => sum + item.issued, 0);
            const totalReleased = gridData.reduce((sum, item) => sum + item.released, 0);
            const totalRemaining = gridData.reduce((sum, item) => sum + item.remaining, 0);
            
            charts.statusPie = new Chart(
                document.getElementById('statusPieChart').getContext('2d'),
                {
                    type: 'pie',
                    data: {
                        labels: ['Released', 'Remaining'],
                        datasets: [{
                            data: [totalReleased, totalRemaining],
                            backgroundColor: ['#2ecc71', '#e74c3c'],
                            borderWidth: 1
                        }]
                    },
                    options: getPieChartOptions('Status Distribution')
                }
            );
            
            // Discipline-Category Stacked Bar Chart
            const disciplines = [...new Set(gridData.map(item => item.discipline))];
            const categories = [...new Set(gridData.map(item => item.category))].sort();
            
            charts.disciplineCategory = new Chart(
                document.getElementById('disciplineCategoryChart').getContext('2d'),
                {
                    type: 'bar',
                    data: getStackedBarData('Issue_Punch'),
                    options: getStackedBarOptions('Issues by Discipline and Category')
                }
            );
            
            // Discipline Bar Chart
            charts.disciplineBar = new Chart(
                document.getElementById('disciplineBarChart').getContext('2d'),
                {
                    type: 'bar',
                    data: getDisciplineBarData(),
                    options: getBarChartOptions('Issues by Discipline')
                }
            );
            
            // Completion Rate Chart
            charts.completionRate = new Chart(
                document.getElementById('completionRateChart').getContext('2d'),
                {
                    type: 'bar',
                    data: getCompletionRateData(),
                    options: getPercentageBarOptions('Completion Rate by Discipline (%)')
                }
            );
            
            // Category Bar Chart
            charts.categoryBar = new Chart(
                document.getElementById('categoryBarChart').getContext('2d'),
                {
                    type: 'bar',
                    data: getCategoryBarData(),
                    options: getBarChartOptions('Issues by Category')
                }
            );
            
            // Remaining Pie Chart
            charts.remainingPie = new Chart(
                document.getElementById('remainingPieChart').getContext('2d'),
                {
                    type: 'pie',
                    data: getRemainingPieData(),
                    options: getPieChartOptions('Remaining Issues by Category')
                }
            );
            
            // Activity Trend Chart
            charts.activityTrend = new Chart(
                document.getElementById('activityTrendChart').getContext('2d'),
                {
                    type: 'line',
                    data: getActivityTrendData(30),
                    options: getLineChartOptions('Recent Activity Trends')
                }
            );
            
            // Add event listeners for interactive controls
            document.getElementById('showPercentages').addEventListener('change', function() {
                charts.statusPie.options.plugins.datalabels.display = this.checked;
                charts.statusPie.update();
                charts.remainingPie.options.plugins.datalabels.display = this.checked;
                charts.remainingPie.update();
            });
            
            document.getElementById('stackedBarMetric').addEventListener('change', function() {
                charts.disciplineCategory.data = getStackedBarData(this.value);
                charts.disciplineCategory.update();
            });
            
            document.getElementById('trendTimeFrame').addEventListener('change', function() {
                charts.activityTrend.data = getActivityTrendData(parseInt(this.value));
                charts.activityTrend.update();
            });
        }
        
        // Chart data functions
        function getStackedBarData(metric) {
            const disciplines = [...new Set(gridData.map(item => item.discipline))];
            const categories = [...new Set(gridData.map(item => item.category))].sort();
            
            return {
                labels: disciplines,
                datasets: categories.map(category => {
                    return {
                        label: `Category ${category}`,
                        data: disciplines.map(discipline => {
                            const item = gridData.find(d => d.discipline === discipline && d.category === category);
                            if (!item) return 0;
                            switch(metric) {
                                case 'Issue_Punch': return item.issued;
                                case 'Release_Punch': return item.released;
                                case 'Total_Remain': return item.remaining;
                                default: return item.issued;
                            }
                        }),
                        backgroundColor: getCategoryColor(category),
                        stack: 'stack'
                    };
                })
            };
        }
        
        function getDisciplineBarData() {
            const disciplines = [...new Set(gridData.map(item => item.discipline))];
            
            return {
                labels: disciplines,
                datasets: [
                    {
                        label: 'Issued',
                        data: disciplines.map(discipline => 
                            gridData.filter(item => item.discipline === discipline)
                            .reduce((sum, item) => sum + item.issued, 0)
                        ),
                        backgroundColor: '#3498db'
                    },
                    {
                        label: 'Released',
                        data: disciplines.map(discipline => 
                            gridData.filter(item => item.discipline === discipline)
                            .reduce((sum, item) => sum + item.released, 0)
                        ),
                        backgroundColor: '#2ecc71'
                    },
                    {
                        label: 'Remaining',
                        data: disciplines.map(discipline => 
                            gridData.filter(item => item.discipline === discipline)
                            .reduce((sum, item) => sum + item.remaining, 0)
                        ),
                        backgroundColor: '#e74c3c'
                    }
                ]
            };
        }
        
        function getCompletionRateData() {
            const disciplines = [...new Set(gridData.map(item => item.discipline))];
            
            return {
                labels: disciplines,
                datasets: [{
                    label: 'Completion Rate (%)',
                    data: disciplines.map(discipline => {
                        const disciplineData = gridData.filter(item => item.discipline === discipline);
                        const totalIssued = disciplineData.reduce((sum, item) => sum + item.issued, 0);
                        const totalReleased = disciplineData.reduce((sum, item) => sum + item.released, 0);
                        return totalIssued > 0 ? (totalReleased / totalIssued * 100).toFixed(1) : 0;
                    }),
                    backgroundColor: '#1abc9c'
                }]
            };
        }
        
        function getCategoryBarData() {
            const categories = [...new Set(gridData.map(item => item.category))].sort();
            
            return {
                labels: categories.map(c => `Category ${c}`),
                datasets: [
                    {
                        label: 'Issued',
                        data: categories.map(category => 
                            gridData.filter(item => item.category === category)
                            .reduce((sum, item) => sum + item.issued, 0)
                        ),
                        backgroundColor: '#3498db'
                    },
                    {
                        label: 'Released',
                        data: categories.map(category => 
                            gridData.filter(item => item.category === category)
                            .reduce((sum, item) => sum + item.released, 0)
                        ),
                        backgroundColor: '#2ecc71'
                    },
                    {
                        label: 'Remaining',
                        data: categories.map(category => 
                            gridData.filter(item => item.category === category)
                            .reduce((sum, item) => sum + item.remaining, 0)
                        ),
                        backgroundColor: '#e74c3c'
                    }
                ]
            };
        }
        
        function getRemainingPieData() {
            const categories = [...new Set(gridData.map(item => item.category))].sort();
            
            return {
                labels: categories.map(c => `Category ${c}`),
                datasets: [{
                    data: categories.map(category => 
                        gridData.filter(item => item.category === category)
                        .reduce((sum, item) => sum + item.remaining, 0)
                    ),
                    backgroundColor: categories.map(c => getCategoryColor(c)),
                    borderWidth: 1
                }]
            };
        }
        
        function getActivityTrendData(days) {
            const disciplines = [...new Set(gridData.map(item => item.discipline))];
            
            let releasedData, issuedData;
            if (days === 30) {
                releasedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.released30, 0)
                );
                issuedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.issued30, 0)
                );
            } else if (days === 7) {
                releasedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.released7, 0)
                );
                issuedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.issued7, 0)
                );
            } else {
                releasedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.releasedToday, 0)
                );
                issuedData = disciplines.map(discipline => 
                    gridData.filter(item => item.discipline === discipline)
                    .reduce((sum, item) => sum + item.issuedToday, 0)
                );
            }
            
            return {
                labels: disciplines,
                datasets: [
                    {
                        label: 'Released',
                        data: releasedData,
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Issued',
                        data: issuedData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            };
        }
        
        // Chart options functions
        function getPieChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    },
                    datalabels: {
                        display: true,
                        formatter: (value, ctx) => {
                            const datapoints = ctx.chart.data.datasets[0].data;
                            const total = datapoints.reduce((total, datapoint) => total + datapoint, 0);
                            const percentage = (value / total * 100).toFixed(1);
                            return `${percentage}%`;
                        },
                        color: '#fff',
                        font: {
                            weight: 'bold'
                        }
                    }
                }
            };
        }
        
        function getStackedBarOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.dataset.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            };
        }
        
        function getBarChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.dataset.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            };
        }
        
        function getPercentageBarOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return `${value}%`;
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.raw}%`;
                            }
                        }
                    }
                }
            };
        }
        
        function getLineChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.dataset.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            };
        }
        
        // Helper function to get color for category
        function getCategoryColor(category) {
            const colors = {
                'A': '#3498db',
                'B': '#2ecc71',
                'C': '#e74c3c',
                'D': '#f39c12',
                'E': '#9b59b6'
            };
            return colors[category] || '#95a5a6';
        }
        
        // Initialize AG-Grid
        function initGrid() {
            const columnDefs = [
                { headerName: "Discipline", field: "discipline", sortable: true, filter: true, width: 100 },
                { headerName: "Category", field: "category", sortable: true, filter: true, width: 100 },
                { headerName: "Issued", field: "issued", sortable: true, filter: true, width: 100 },
                { headerName: "Released", field: "released", sortable: true, filter: true, width: 100 },
                { headerName: "Remaining", field: "remaining", sortable: true, filter: true, width: 120,
                    cellStyle: params => params.value > 0 ? { color: '#e74c3c', fontWeight: 'bold' } : null },
                { headerName: "Released (30d)", field: "released30", sortable: true, filter: true, width: 130 },
                { headerName: "Released (7d)", field: "released7", sortable: true, filter: true, width: 120 },
                { headerName: "Released Today", field: "releasedToday", sortable: true, filter: true, width: 130 },
                { headerName: "Issued (30d)", field: "issued30", sortable: true, filter: true, width: 120 },
                { headerName: "Issued (7d)", field: "issued7", sortable: true, filter: true, width: 110 },
                { headerName: "Issued Today", field: "issuedToday", sortable: true, filter: true, width: 120 },
                { headerName: "Completion %", field: "completionRate", sortable: true, filter: true, width: 130,
                    cellStyle: params => params.value < 50 ? { color: '#e74c3c' } : { color: '#2ecc71' } }
            ];
            
            const gridOptions = {
                columnDefs: columnDefs,
                rowData: gridData,
                defaultColDef: {
                    resizable: true
                },
                pagination: true,
                paginationPageSize: 10,
                domLayout: 'autoHeight',
                onGridReady: function(params) {
                    params.api.sizeColumnsToFit();
                }
            };
            
            new agGrid.Grid(document.getElementById('dataGrid'), gridOptions);
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', function() {
                gridOptions.api.exportDataAsCsv();
            });
        }
        
        // Load data when page is ready
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
