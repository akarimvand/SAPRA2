<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subsystem Summary Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #f8f9fa; padding: 15px; }
        .report-container { background: white; max-width: 100%; margin: 0 auto; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .matrix-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px; }
        .matrix-card { border: none; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.12); transition: all 0.3s ease; cursor: pointer; }
        .matrix-card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.18); }
        .matrix-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 10px; }
        .matrix-card .count { font-size: 44px; font-weight: 700; margin: 10px 0; }
        .matrix-card .percentage { font-size: 13px; opacity: 0.9; font-weight: 500; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 20px; }
        .data-table th { background: #e9ecef; color: #212529; padding: 10px; border: 1px solid #dee2e6; font-weight: 600; text-align: center; font-size: 14px; }
        .data-table td { padding: 8px 10px; border: 1px solid #dee2e6; text-align: center; font-size: 13px; }
        .data-table tbody tr:nth-child(even) { background: #fafafa; }
        .progress-bar-custom { height: 22px; border-radius: 11px; background: #e9ecef; overflow: hidden; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #059669); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; }
        .step-indicator { display: flex; align-items: center; justify-content: center; gap: 4px; }
        .step { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 11px; border: 2px solid #e2e8f0; background: white; color: #cbd5e0; transition: all 0.3s ease; position: relative; cursor: pointer; }
        .step:hover { transform: scale(1.12); box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
        .step.completed { animation: pulse 0.5s ease; }
        .filter-step { width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: 10px; border: 2px solid #e2e8f0; background: white; cursor: pointer; transition: all 0.2s; margin: 0 3px; position: relative; }
        .filter-step:hover { transform: scale(1.15); box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
        .filter-step.filter-a { background: linear-gradient(135deg, #10b981, #059669); border-color: #10b981; color: white; }
        .filter-step.filter-b { background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: #3b82f6; color: white; }
        .filter-step.filter-c { background: linear-gradient(135deg, #f59e0b, #d97706); border-color: #f59e0b; color: white; }
        .filter-step.filter-d { background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-color: #8b5cf6; color: white; }
        .filter-step.filter-none { border-color: #cbd5e0; color: #999; background: white; }
        .filter-step.filter-reset { border-color: #ef4444; color: #ef4444; background: white; font-size: 14px; }
        .step-a::after { content: 'A'; position: absolute; font-size: 11px; font-weight: bold; }
        .step-b::after { content: 'B'; position: absolute; font-size: 11px; font-weight: bold; }
        .step-c::after { content: 'C'; position: absolute; font-size: 11px; font-weight: bold; }
        .step-d::after { content: 'D'; position: absolute; font-size: 11px; font-weight: bold; }
        .step-a.completed { background: linear-gradient(135deg, #10b981, #059669); border-color: #10b981; color: white; }
        .step-b.completed { background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: #3b82f6; color: white; }
        .step-c.completed { background: linear-gradient(135deg, #f59e0b, #d97706); border-color: #f59e0b; color: white; }
        .step-d.completed { background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-color: #8b5cf6; color: white; }
        .step-line { width: 14px; height: 3px; background: #e2e8f0; transition: all 0.3s ease; border-radius: 2px; }
        .step-line.completed { background: linear-gradient(90deg, #10b981, #3b82f6); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .punch-badge { display: inline-flex; align-items: center; gap: 3px; padding: 5px 10px; border-radius: 6px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .punch-badge:hover { transform: scale(1.08); box-shadow: 0 3px 10px rgba(0,0,0,0.25); }
        .punch-a { background: #fee; color: #c00; }
        .punch-b { background: #ffd; color: #c60; }
        .punch-c { background: #efe; color: #060; }
        .clickable { cursor: pointer; color: #3b82f6; font-weight: 600; transition: all 0.2s; }
        .clickable:hover { color: #1d4ed8; text-decoration: underline; transform: scale(1.05); }
        .tag-no-btn { padding: 2px 8px; border: none; background: #0d6efd; color: white; font-weight: 500; text-decoration: none; cursor: pointer; border-radius: 4px; font-size: 0.8rem; transition: all 0.2s ease; }
        .tag-no-btn:hover { background: #0b5ed7; }
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { background: #555; }
        .sortable::after { content: '⇅'; margin-right: 3px; opacity: 0.5; font-size: 10px; }
        .sortable.asc::after { content: '↑'; opacity: 1; }
        .sortable.desc::after { content: '↓'; opacity: 1; }
        .filter-input { width: 100%; padding: 5px 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 11px; }
        .action-buttons { display: flex; gap: 12px; margin-bottom: 20px; justify-content: flex-end; }
        .btn-action { background: #0d6efd; color: white; border: none; padding: 11px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(13,110,253,0.2); }
        .btn-action:hover { background: #0b5ed7; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(13,110,253,0.3); }
        .btn-action:first-child { background: #198754; }
        .btn-action:first-child:hover { background: #157347; }
        .btn-action i { margin-left: 8px; font-size: 16px; }
        @media (max-width: 768px) {
            .matrix-container { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .action-buttons { flex-direction: column; }
            .btn-action { width: 100%; }
        }
        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            @page { size: A4 landscape; margin: 10mm; }
        }
    </style>
</head>
<body>
    <div class="report-container">
        <div id="reportContent"></div>
    </div>

    <div class="modal fade" id="activitiesModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                <div class="modal-header" style="background: #fff; border-bottom: 1px solid #e0e0e0; padding: 12px 16px;">
                    <div class="d-flex align-items-center gap-2">
                        <i class="bi bi-list-task" style="font-size: 1.25rem; color: #495057;"></i>
                        <div>
                            <h6 class="mb-0" style="font-weight: 600; font-size: 0.95rem; color: #212529;">Activities</h6>
                            <small style="color: #6c757d;">Tag: <strong id="activitiesTagTitle" style="color: #212529;">N/A</strong></small>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="font-size: 0.8rem;"></button>
                </div>
                <div class="modal-body" style="padding: 16px;">
                    <div class="mb-3" style="background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 3px solid #0d6efd;">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small style="font-weight: 500; color: #495057;">Progress</small>
                            <small style="font-weight: 700; color: #0d6efd;" id="activitiesProgressText">0%</small>
                        </div>
                        <div class="progress" style="height: 6px; border-radius: 3px;">
                            <div class="progress-bar bg-primary" id="activitiesProgressFill" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sm table-hover mb-0" style="font-size: 0.875rem;">
                            <thead style="background: #f8f9fa;">
                                <tr><th style="padding: 8px;">#</th><th style="padding: 8px;">Form Title</th><th style="padding: 8px; text-align: center;">Status</th></tr>
                            </thead>
                            <tbody id="activitiesList"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #e0e0e0; padding: 10px 16px;">
                    <button type="button" class="btn btn-success btn-sm" id="exportActivitiesBtn"><i class="bi bi-file-earmark-excel me-1"></i>Export</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="itemDetailsModal" tabindex="-1" style="z-index: 1055;">
        <div class="modal-dialog modal-fullscreen-lg-down modal-dialog-scrollable" style="max-width: 95%;">
            <div class="modal-content" style="border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                <div class="modal-header" style="background: #fff; border-bottom: 1px solid #e0e0e0; padding: 12px 16px;">
                    <h6 class="modal-title mb-0" id="itemDetailsModalLabel" style="font-weight: 600; font-size: 0.95rem;">Item Details</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="font-size: 0.8rem;"></button>
                </div>
                <div class="modal-body" style="padding: 16px;">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover mb-0" style="font-size: 0.875rem;">
                            <thead style="background: #f8f9fa; position: sticky; top: 0; z-index: 10;">
                                <tr id="itemDetailsModalHeader"></tr>
                                <tr id="modal-filter-row"></tr>
                            </thead>
                            <tbody id="itemDetailsTableBody"></tbody>
                        </table>
                    </div>
                    <div id="noDetailsMessage" class="text-center text-muted py-4" style="display: none;">No matching items found.</div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #e0e0e0; padding: 10px 16px;">
                    <button type="button" class="btn btn-success btn-sm" id="exportDetailsExcelBtn"><i class="bi bi-file-earmark-excel me-1"></i>Export</button>
                    <button type="button" class="btn btn-primary btn-sm" id="printModalBtn"><i class="bi bi-printer me-1"></i>Print</button>
                    <button type="button" class="btn btn-secondary btn-sm ms-auto" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script src="ss-summary-report.js"></script>
</body>
</html>
